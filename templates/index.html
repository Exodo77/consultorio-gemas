{% extends 'base.html' %}

{% block title %}Lista de Pacientes{% endblock %}

{% block content %}
<h1 class="mb-4">Lista de Pacientes</h1>

{# Fila para el formulario de búsqueda y el botón de añadir paciente #}
<div class="row mb-4 align-items-center">
    <div class="col-md-8 col-lg-9">
        <form class="d-flex" role="search" method="GET">
            <input class="form-control me-2" type="search" placeholder="Buscar paciente por nombre..." aria-label="Search" name="search" value="{{ search_query }}">
            <button class="btn btn-outline-primary" type="submit">Buscar</button>
        </form>
    </div>
    <div class="col-md-4 col-lg-3 text-md-end mt-2 mt-md-0">
        <a href="{{ url_for('add_patient') }}" class="btn btn-primary w-100 w-md-auto">Añadir Nuevo Paciente</a>
    </div>
</div>

{% if patients %}
    <div class="table-responsive">
        <table class="table table-striped table-hover table-responsive-cards">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Fecha de Nacimiento</th>
                    <th>Género</th>
                    <th>Teléfono</th>
                    <th>Email</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for patient in patients %}
                    <tr>
                        <td data-label="Nombre">{{ patient.name }}</td>
                        <td data-label="Fecha Nacimiento">{{ patient.dob }}</td>
                        <td data-label="Género">{{ patient.gender }}</td>
                        <td data-label="Teléfono">{{ patient.phone }}</td>
                        <td data-label="Email">{{ patient.email }}</td>
                        <td data-label="Acciones">
                            {# AQUÍ ESTÁ EL CAMBIO CLAVE #}
                            <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                                <a href="{{ url_for('patient_details', patient_id=patient.id) }}" class="btn btn-info btn-sm">Detalles</a>
                                <a href="{{ url_for('edit_patient', patient_id=patient.id) }}" class="btn btn-warning btn-sm">Editar</a>
                                <form action="{{ url_for('delete_patient', patient_id=patient.id) }}" method="POST" class="d-inline"> {# Volvemos a d-inline para que el form no ocupe todo el ancho en PC #}
                                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro de que quieres eliminar a este paciente y todos sus registros médicos?');">Eliminar</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p class="alert alert-info">No hay pacientes registrados aún.</p>
{% endif %}
{% endblock %}